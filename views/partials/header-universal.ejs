<% 
  // Access variables from parent scope
  const user = typeof currentUser !== 'undefined' && currentUser ? currentUser : null;
  const page = typeof currentPage !== 'undefined' ? currentPage : '';
  const isHomepageFlag = typeof isHomepage !== 'undefined' && isHomepage === true;
%>
<header class="universal-header <%= isHomepageFlag ? 'universal-header--homepage' : '' %>" role="banner">
  <div class="universal-header__inner">
    <a class="universal-header__logo" href="/">ZIPSITE</a>
    
    <button class="universal-header__menu-toggle" aria-expanded="false" aria-controls="universalNav" aria-label="Toggle navigation">
      <span></span>
      <span></span>
      <span></span>
    </button>
    
    <nav class="universal-header__nav" aria-label="Primary">
      <ul>
        <li><a href="/" <%= page === '/' || page === 'home' ? 'aria-current="page"' : '' %>>Home</a></li>
        <li><a href="/features" <%= page === 'features' ? 'aria-current="page"' : '' %>>Features</a></li>
        <li><a href="/pricing" <%= page === 'pricing' ? 'aria-current="page"' : '' %>>Pricing</a></li>
        <li><a href="/pro" <%= page === 'pro' ? 'aria-current="page"' : '' %>>Pro</a></li>
        <li><a href="/press" <%= page === 'press' ? 'aria-current="page"' : '' %>>Press</a></li>
      </ul>
    </nav>

    <div class="universal-header__actions">
      <% if (user && user.id && user.role) { %>
        <% 
          const dashboardHref = user.role === 'AGENCY' ? '/dashboard/agency' : '/dashboard/talent';
          const userProfile = typeof profile !== 'undefined' ? profile : null;
        %>
        <div class="universal-header__user-wrapper">
          <div class="universal-header__user-dropdown">
            <button type="button" class="universal-header__user" data-initial="<%= user.email ? user.email.charAt(0).toUpperCase() : 'U' %>" aria-label="User menu" aria-expanded="false" id="universal-user-menu-button">
              <span class="universal-header__user-email"><%= user.email %></span>
              <% if (userProfile && userProfile.is_pro) { %>
                <span class="universal-header__badge universal-header__badge--pro">Pro</span>
              <% } else if (userProfile && !userProfile.is_pro) { %>
                <span class="universal-header__badge universal-header__badge--free">Free</span>
              <% } %>
              <svg class="universal-header__user-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="universal-header__user-menu" id="universal-user-menu" role="menu" aria-labelledby="universal-user-menu-button">
              <a href="<%= dashboardHref %>" class="universal-header__user-menu-item" role="menuitem">
                <svg class="universal-header__user-menu-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 8C2 10.2091 3.79086 12 6 12C7.86384 12 9.42994 10.7252 9.87398 9H14V7H9.87398C9.42994 5.27477 7.86384 4 6 4C3.79086 4 2 5.79086 2 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M14 8C14 10.2091 12.2091 12 10 12C8.13616 12 6.57006 10.7252 6.12602 9H2V7H6.12602C6.57006 5.27477 8.13616 4 10 4C12.2091 4 14 5.79086 14 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Dashboard</span>
              </a>
              <a href="/dashboard/settings" class="universal-header__user-menu-item" role="menuitem">
                <svg class="universal-header__user-menu-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13.6569 10.3431C13.8447 10.5309 13.9492 10.7852 13.9492 11.0503C13.9492 11.3153 13.8447 11.5696 13.6569 11.7574L11.7574 13.6569C11.5696 13.8447 11.3153 13.9492 11.0503 13.9492C10.7852 13.9492 10.5309 13.8447 10.3431 13.6569L2.34315 5.65685C2.15536 5.46906 2.05086 5.21481 2.05086 4.94975C2.05086 4.68469 2.15536 4.43044 2.34315 4.24264L4.24264 2.34315C4.43044 2.15536 4.68469 2.05086 4.94975 2.05086C5.21481 2.05086 5.46906 2.15536 5.65685 2.34315L13.6569 10.3431Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Settings</span>
              </a>
              <form method="post" action="/logout" class="universal-header__user-menu-item-form">
                <button type="submit" class="universal-header__user-menu-item universal-header__user-menu-item--logout" role="menuitem">
                  <svg class="universal-header__user-menu-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 14H3.33333C2.59695 14 2 13.403 2 12.6667V3.33333C2 2.59695 2.59695 2 3.33333 2H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 11.3333L14 8L10 4.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 8H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>Logout</span>
                </button>
              </form>
            </div>
          </div>
        </div>
      <% } else { %>
        <a class="universal-header__link" href="/login">Login</a>
        <a class="universal-header__cta universal-header__cta--primary" href="/apply">Start Creating</a>
      <% } %>
    </div>
  </div>
  
  <div class="universal-header__nav-panel" id="universalNav" hidden>
    <nav class="universal-header__mobile-nav" aria-label="Primary">
      <ul>
        <li><a href="/" <%= page === '/' || page === 'home' ? 'aria-current="page"' : '' %>>Home</a></li>
        <li><a href="/features" <%= page === 'features' ? 'aria-current="page"' : '' %>>Features</a></li>
        <li><a href="/pricing" <%= page === 'pricing' ? 'aria-current="page"' : '' %>>Pricing</a></li>
        <li><a href="/pro" <%= page === 'pro' ? 'aria-current="page"' : '' %>>Pro</a></li>
        <li><a href="/press" <%= page === 'press' ? 'aria-current="page"' : '' %>>Press</a></li>
        <% if (user && user.id && user.role) { %>
          <% const dashboardHref = user.role === 'AGENCY' ? '/dashboard/agency' : '/dashboard/talent'; %>
          <% const dashboardLabel = user.role === 'AGENCY' ? 'Agency Portal' : 'My Portfolio'; %>
          <li><a href="<%= dashboardHref %>"><%= dashboardLabel %></a></li>
          <li><a href="/dashboard/settings">Settings</a></li>
          <li>
            <form method="post" action="/logout" style="display: inline;">
              <button type="submit" style="background: none; border: none; color: inherit; font: inherit; cursor: pointer; padding: 0; text-decoration: underline;">Logout</button>
            </form>
          </li>
        <% } else { %>
          <li><a href="/login">Login</a></li>
          <li><a class="universal-header__cta universal-header__cta--primary" href="/apply">Start Creating</a></li>
        <% } %>
      </ul>
    </nav>
  </div>
</header>

