<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title || 'Dashboard' %> â€¢ Pholio
    </title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Display:wght@200;300;400&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/styles/global.css?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>">
    <link rel="stylesheet" href="/styles/dashboard.css?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>">
    <% if (typeof user !== 'undefined' && user && user.role === 'AGENCY') { %>
        <link rel="stylesheet" href="/styles/agency-dashboard.css?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>">
        <link rel="stylesheet" href="/styles/agency-dashboard-mobile.css?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>">
        <link rel="stylesheet" href="/styles/agency-dashboard-discover.css?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>">
        <link rel="stylesheet" href="/styles/toast.css?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>">
    <% } %>
</head>

<body class="dashboard-body <%= typeof user !== 'undefined' && user && user.role === 'AGENCY' ? 'dashboard-body--agency' : 'dashboard-body--talent' %>">

    <!-- Dashboard Header -->
    <header class="dash-header" <% if (typeof user !== 'undefined' && user && user.role === 'AGENCY') { %>style="display: none;"<% } %>>
        <div class="dash-header__inner">
            <!-- Logo Section -->
            <div class="dash-header__logo-wrapper">
                <% if (typeof user !== 'undefined' && user && user.agency_logo_path) { %>
                    <a href="/" class="dash-header__logo-link">
                        <img src="<%= user.agency_logo_path %>" alt="<%= user.agency_name || 'Agency' %>" class="dash-header__agency-logo">
                    </a>
                <% } else { %>
                    <a href="/" class="dash-header__logo">PHOLIO</a>
                <% } %>
            </div>

            <!-- Navigation Section - Dashboard Sections Menu -->
            <nav class="dash-header__nav" aria-label="Dashboard sections">
                <% if (typeof user !== 'undefined' && user && user.role === 'TALENT') { %>
                    <a href="/dashboard/talent#overview" class="dash-header__nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'talent' ? 'is-active' : '' %>">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 8C2 10.2091 3.79086 12 6 12C7.86384 12 9.42994 10.7252 9.87398 9H14V7H9.87398C9.42994 5.27477 7.86384 4 6 4C3.79086 4 2 5.79086 2 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 8C14 10.2091 12.2091 12 10 12C8.13616 12 6.57006 10.7252 6.12602 9H2V7H6.12602C6.57006 5.27477 8.13616 4 10 4C12.2091 4 14 5.79086 14 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Overview</span>
                    </a>
                    <a href="/dashboard/talent#profile-details" class="dash-header__nav-link">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11.3333 2H4.66667C3.74619 2 3 2.74619 3 3.66667V12.3333C3 13.2538 3.74619 14 4.66667 14H11.3333C12.2538 14 13 13.2538 13 12.3333V3.66667C13 2.74619 12.2538 2 11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5.33333 6H10.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5.33333 9.33333H10.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Profile</span>
                    </a>
                    <a href="/dashboard/talent#portfolio-imagery" class="dash-header__nav-link">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 4C2 2.89543 2.89543 2 4 2H12C13.1046 2 14 2.89543 14 4V12C14 13.1046 13.1046 14 12 14H4C2.89543 14 2 13.1046 2 12V4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M6 6.5C6.55228 6.5 7 6.05228 7 5.5C7 4.94772 6.55228 4.5 6 4.5C5.44772 4.5 5 4.94772 5 5.5C5 6.05228 5.44772 6.5 6 6.5Z" fill="currentColor"/>
                            <path d="M2 10L5 7L8 10L11 7L14 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Portfolio</span>
                    </a>
                    <a href="/dashboard/talent#analytics" class="dash-header__nav-link">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 12L6 8L9 11L14 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10 6H14V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Analytics</span>
                    </a>
                    <a href="/dashboard/settings" class="dash-header__nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'settings' ? 'is-active' : '' %>">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13.6569 10.3431C13.8447 10.5309 13.9492 10.7852 13.9492 11.0503C13.9492 11.3153 13.8447 11.5696 13.6569 11.7574L11.7574 13.6569C11.5696 13.8447 11.3153 13.9492 11.0503 13.9492C10.7852 13.9492 10.5309 13.8447 10.3431 13.6569L2.34315 5.65685C2.15536 5.46906 2.05086 5.21481 2.05086 4.94975C2.05086 4.68469 2.15536 4.43044 2.34315 4.24264L4.24264 2.34315C4.43044 2.15536 4.68469 2.05086 4.94975 2.05086C5.21481 2.05086 5.46906 2.15536 5.65685 2.34315L13.6569 10.3431Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Settings</span>
                    </a>
                    <% if (typeof profile !== 'undefined' && profile && profile.slug) { %>
                        <a href="/portfolio/<%= profile.slug %>" target="_blank" rel="noopener" class="dash-header__nav-link dash-header__nav-link--external">
                            <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 3H3C2.44772 3 2 3.44772 2 4V13C2 13.5523 2.44772 14 3 14H12C12.5523 14 13 13.5523 13 13V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 2H14V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M6 10L14 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>View Live</span>
                        </a>
                    <% } %>
                <% } else if (typeof user !== 'undefined' && user && user.role === 'AGENCY') { %>
                    <a href="/" class="dash-header__nav-link">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 9l5-4 5 4v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 13V9h2v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Home</span>
                    </a>
                    <a href="/dashboard/agency#agency-overview" class="dash-header__nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'agency' ? 'is-active' : '' %>">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 8C2 10.2091 3.79086 12 6 12C7.86384 12 9.42994 10.7252 9.87398 9H14V7H9.87398C9.42994 5.27477 7.86384 4 6 4C3.79086 4 2 5.79086 2 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 8C14 10.2091 12.2091 12 10 12C8.13616 12 6.57006 10.7252 6.12602 9H2V7H6.12602C6.57006 5.27477 8.13616 4 10 4C12.2091 4 14 5.79086 14 8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Overview</span>
                    </a>
                    <a href="/dashboard/agency#applications" class="dash-header__nav-link">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 4C2 2.89543 2.89543 2 4 2H12C13.1046 2 14 2.89543 14 4V12C14 13.1046 13.1046 14 12 14H4C2.89543 14 2 13.1046 2 12V4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M6 6.5C6.55228 6.5 7 6.05228 7 5.5C7 4.94772 6.55228 4.5 6 4.5C5.44772 4.5 5 4.94772 5 5.5C5 6.05228 5.44772 6.5 6 6.5Z" fill="currentColor"/>
                            <path d="M2 10L5 7L8 10L11 7L14 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Applications</span>
                    </a>
                    <a href="/dashboard/agency#analytics" class="dash-header__nav-link">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 12L6 8L9 11L14 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10 6H14V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Analytics</span>
                    </a>
                    <a href="/dashboard/settings" class="dash-header__nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'settings' ? 'is-active' : '' %>">
                        <svg class="dash-header__nav-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13.6569 10.3431C13.8447 10.5309 13.9492 10.7852 13.9492 11.0503C13.9492 11.3153 13.8447 11.5696 13.6569 11.7574L11.7574 13.6569C11.5696 13.8447 11.3153 13.9492 11.0503 13.9492C10.7852 13.9492 10.5309 13.8447 10.3431 13.6569L2.34315 5.65685C2.15536 5.46906 2.05086 5.21481 2.05086 4.94975C2.05086 4.68469 2.15536 4.43044 2.34315 4.24264L4.24264 2.34315C4.43044 2.15536 4.68469 2.05086 4.94975 2.05086C5.21481 2.05086 5.46906 2.15536 5.65685 2.34315L13.6569 10.3431Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Settings</span>
                    </a>
                <% } %>
            </nav>

            <!-- User Section -->
            <div class="dash-header__user-wrapper">
                <% if (typeof user !== 'undefined' && user) { %>
                    <% 
                      // Get user name from profile or fallback to email
                      let dashDisplayName = '';
                      let dashUserInitial = 'U';
                      if (typeof profile !== 'undefined' && profile && profile.first_name && profile.last_name) {
                        dashDisplayName = profile.first_name + ' ' + profile.last_name;
                        dashUserInitial = profile.first_name.charAt(0).toUpperCase();
                      } else if (typeof profile !== 'undefined' && profile && profile.first_name) {
                        dashDisplayName = profile.first_name;
                        dashUserInitial = profile.first_name.charAt(0).toUpperCase();
                      } else if (user.email) {
                        dashDisplayName = user.email.split('@')[0];
                        dashUserInitial = user.email.charAt(0).toUpperCase();
                      }
                      const dashRoleLabel = user.role === 'AGENCY' ? 'Agency' : 'Talent';
                    %>
                    <div class="dash-header__user-dropdown">
                        <button type="button" class="dash-header__user" data-initial="<%= dashUserInitial %>" aria-label="User menu" aria-expanded="false" id="user-menu-button">
                            <span class="dash-header__user-name"><%= dashDisplayName %></span>
                            <span class="dash-header__badge dash-header__badge--role"><%= dashRoleLabel %></span>
                            <% if (typeof profile !== 'undefined' && profile && profile.is_pro) { %>
                                <span class="dash-header__badge dash-header__badge--pro">Studio+</span>
                            <% } else if (typeof profile !== 'undefined' && profile && !profile.is_pro) { %>
                                <span class="dash-header__badge dash-header__badge--free">Free</span>
                            <% } %>
                            <svg class="dash-header__user-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="dash-header__user-menu" id="user-menu" role="menu" aria-labelledby="user-menu-button">
                            <!-- User Info Header -->
                            <div class="dash-header__user-menu-header">
                                <div class="dash-header__user-menu-avatar" data-initial="<%= dashUserInitial %>"></div>
                                <div class="dash-header__user-menu-info">
                                    <div class="dash-header__user-menu-name"><%= dashDisplayName %></div>
                                    <div class="dash-header__user-menu-email"><%= user.email %></div>
                                    <div class="dash-header__user-menu-role"><%= dashRoleLabel %></div>
                                </div>
                            </div>
                            <div class="dash-header__user-menu-divider"></div>
                            <a href="/dashboard/settings" class="dash-header__user-menu-item" role="menuitem">
                                <svg class="dash-header__user-menu-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M13.6569 10.3431C13.8447 10.5309 13.9492 10.7852 13.9492 11.0503C13.9492 11.3153 13.8447 11.5696 13.6569 11.7574L11.7574 13.6569C11.5696 13.8447 11.3153 13.9492 11.0503 13.9492C10.7852 13.9492 10.5309 13.8447 10.3431 13.6569L2.34315 5.65685C2.15536 5.46906 2.05086 5.21481 2.05086 4.94975C2.05086 4.68469 2.15536 4.43044 2.34315 4.24264L4.24264 2.34315C4.43044 2.15536 4.68469 2.05086 4.94975 2.05086C5.21481 2.05086 5.46906 2.15536 5.65685 2.34315L13.6569 10.3431Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Settings</span>
                            </a>
                            <form method="post" action="/logout" class="dash-header__user-menu-item-form">
                                <button type="submit" class="dash-header__user-menu-item dash-header__user-menu-item--logout" role="menuitem">
                                    <svg class="dash-header__user-menu-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M6 14H3.33333C2.59695 14 2 13.403 2 12.6667V3.33333C2 2.59695 2.59695 2 3.33333 2H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10 11.3333L14 8L10 4.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14 8H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Logout</span>
                                </button>
                            </form>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </header>

    <!-- Flash Messages -->
    <% if (typeof messages !=='undefined' && messages && messages.length> 0) { %>
        <div class="flash-messages">
            <% messages.forEach(msg=> { %>
                <div class="flash-message flash-message--<%= msg.type %>">
                    <span>
                        <%= msg.text %>
                    </span>
                    <button class="flash-message__close" type="button"
                        onclick="this.parentElement.remove()">&times;</button>
                </div>
                <% }); %>
        </div>
        <% } %>

            <!-- Main Dashboard Content -->
            <main class="dash-container">
                <%- body %>
            </main>

            <!-- Dashboard Scripts -->
            <script src="/scripts/dashboard.js?v=<%= Date.now() %>-<%= Math.random().toString(36).substring(7) %>"></script>
</body>

</html>